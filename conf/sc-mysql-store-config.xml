<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>SEASR CENTRAL storage schema for MySQL</comment>

    <entry key="org.seasr.central.storage.db.driver">com.mysql.jdbc.Driver</entry>
    <entry key="org.seasr.central.storage.db.url">
        <![CDATA[jdbc:mysql://localhost/SC?useUnicode=yes&characterEncoding=utf8&autoReconnect=true]]>
    </entry>
    <entry key="org.seasr.central.storage.db.user">sc</entry>
    <entry key="org.seasr.central.storage.db.password">sc</entry>

    <entry key="org.seasr.central.storage.db.logfile">logs/mysql.log</entry>
    <entry key="org.seasr.central.storage.db.loglevel">ALL</entry>

    <entry key="org.seasr.central.storage.link">org.seasr.central.storage.db.SQLLink</entry>

    <entry key="org.seasr.central.storage.db.auth_schema">
        //
        // sc_permission
        //
        CREATE TABLE IF NOT EXISTS sc_permission (
            perm_id  SMALLINT UNSIGNED NOT NULL,
            name     VARCHAR(45) NOT NULL,

            PRIMARY KEY (perm_id),
            UNIQUE INDEX (name ASC)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_role
        //
        CREATE TABLE IF NOT EXISTS sc_role (
            role_id  SMALLINT UNSIGNED NOT NULL,
            name     VARCHAR(30) NOT NULL,

            PRIMARY KEY (role_id),
            UNIQUE INDEX (name ASC)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_user
        //
        CREATE TABLE IF NOT EXISTS sc_user (
            user_uuid    DECIMAL(39) NOT NULL,
            screen_name  VARCHAR(20) NOT NULL,
            password     VARCHAR(80) NOT NULL,
            created_at   DATETIME NOT NULL,
            profile      TEXT NULL,
            deleted      BOOLEAN NOT NULL DEFAULT FALSE,

            PRIMARY KEY (user_uuid),
            UNIQUE INDEX (screen_name ASC),
            INDEX (deleted) USING HASH
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_role_permission
        //
        CREATE TABLE IF NOT EXISTS sc_role_permission (
            role_id  SMALLINT UNSIGNED NOT NULL,
            perm_id  SMALLINT UNSIGNED NOT NULL,

            PRIMARY KEY (role_id, perm_id),
            INDEX (role_id) USING HASH,
            FOREIGN KEY (role_id) REFERENCES sc_role (role_id),
            INDEX (perm_id) USING HASH,
            FOREIGN KEY (perm_id) REFERENCES sc_permission (perm_id)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_user_role
        //
        CREATE TABLE IF NOT EXISTS sc_user_role (
            user_uuid  DECIMAL(39) NOT NULL,
            role_id    SMALLINT UNSIGNED NOT NULL,

            PRIMARY KEY (user_uuid, role_id),
            INDEX (user_uuid) USING HASH,
            FOREIGN KEY (user_uuid) REFERENCES sc_user (user_uuid),
            INDEX (role_id) USING HASH,
            FOREIGN KEY (role_id) REFERENCES sc_role (role_id)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // Populate default roles
        //
        INSERT IGNORE INTO sc_role (role_id, name) VALUES (100, "admin");
        INSERT IGNORE INTO sc_role (role_id, name) VALUES (200, "user");

        //
        // Create the 'admin' user
        //
        INSERT IGNORE INTO sc_user (user_uuid, screen_name, password, created_at, profile) VALUES
            (1, "admin", "d033e22ae348aeb5660fc2140aec35850c4da997", NOW(), "{}");

        //
        // Assign the 'admin' user to the 'admin' role
        //
        INSERT IGNORE INTO sc_user_role (user_uuid, role_id) VALUES (1, 100);
    </entry>

    <entry key="org.seasr.central.storage.db.schema">
        //
        // sc_group
        //
        CREATE TABLE IF NOT EXISTS sc_group (
            group_uuid  DECIMAL(39) NOT NULL,
            name        VARCHAR(45) NOT NULL,
            created_at  DATETIME NOT NULL,
            profile     TEXT NOT NULL,
            deleted     BOOLEAN NOT NULL DEFAULT FALSE,

            PRIMARY KEY (group_uuid),
            UNIQUE INDEX (name ASC)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_user_group
        //
        CREATE TABLE IF NOT EXISTS sc_user_group (
            user_uuid   DECIMAL(39) NOT NULL,
            group_uuid  DECIMAL(39) NOT NULL,

            PRIMARY KEY (user_uuid, group_uuid),
            INDEX (user_uuid) USING HASH,
            FOREIGN KEY (user_uuid) REFERENCES sc_user (user_uuid),
            INDEX (group_uuid) USING HASH,
            FOREIGN KEY (group_uuid) REFERENCES sc_group (group_uuid)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_rights
        //
        CREATE TABLE IF NOT EXISTS sc_rights (
            rights_hash  DECIMAL(39) NOT NULL,
            text         MEDIUMTEXT NOT NULL,

            PRIMARY KEY (rights_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_component_core
        //
        CREATE TABLE IF NOT EXISTS sc_component_core (
            core_hash      DECIMAL(39) NOT NULL,
            firing_policy  VARCHAR(45) NOT NULL,
            mode           VARCHAR(255) NOT NULL,
            format         VARCHAR(45) NOT NULL,
            runnable       VARCHAR(45) NOT NULL,
            res_location   VARCHAR(255) NOT NULL,

            PRIMARY KEY (core_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_component
        //
        CREATE TABLE IF NOT EXISTS sc_component (
            comp_uuid      DECIMAL(39) NOT NULL,
            uploaded_at    DATETIME NOT NULL,
            core_hash      DECIMAL(39) NOT NULL,
            name           VARCHAR(45) NULL,
            creator        VARCHAR(45) NULL,
            creation_date  DATETIME NULL,
            rights_hash    DECIMAL(39) NULL,
            uri            VARCHAR(255) NULL,
            deleted        BOOLEAN NOT NULL DEFAULT FALSE,

            PRIMARY KEY (comp_uuid, uploaded_at),
            INDEX (core_hash) USING HASH,
            FOREIGN KEY (core_hash) REFERENCES sc_component_core (core_hash),
            INDEX (rights_hash) USING HASH,
            FOREIGN KEY (rights_hash) REFERENCES sc_rights (rights_hash),
            INDEX (comp_uuid) USING HASH,
            INDEX (uri) USING HASH,
            INDEX (deleted) USING HASH
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_comp_description
        //
        CREATE TABLE IF NOT EXISTS sc_comp_description (
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            description  TEXT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at),
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_comp_descriptor
        //
        CREATE TABLE IF NOT EXISTS sc_comp_descriptor (
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            descriptor   LONGTEXT NOT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at),
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_comp_tag
        //
        CREATE TABLE IF NOT EXISTS sc_comp_tag (
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            tag          VARCHAR(45) NOT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at, tag),
            INDEX (comp_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at),
            INDEX (tag ASC)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_comp_category
        //
        CREATE TABLE IF NOT EXISTS sc_comp_category (
            cat_name     VARCHAR(45) NOT NULL,
            description  TEXT NOT NULL,

            PRIMARY KEY (cat_name)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_comp_cat_map
        //
        CREATE TABLE IF NOT EXISTS sc_comp_cat_map (
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            cat_name     VARCHAR(45) NOT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at, cat_name),
            INDEX (comp_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at),
            INDEX (cat_name) USING HASH,
            FOREIGN KEY (cat_name) REFERENCES sc_comp_category (cat_name)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_context
        //
        CREATE TABLE IF NOT EXISTS sc_context (
            context_hash  DECIMAL(39) NOT NULL,
            data          LONGBLOB NOT NULL,

            PRIMARY KEY (context_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_component_context
        //
        CREATE TABLE IF NOT EXISTS sc_component_context (
            comp_uuid     DECIMAL(39) NOT NULL,
            uploaded_at   DATETIME NOT NULL,
            context_hash  DECIMAL(39) NOT NULL,
            mime_type     VARCHAR(45) NOT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at, context_hash),
            INDEX (comp_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at),
            INDEX (context_hash) USING HASH,
            FOREIGN KEY (context_hash) REFERENCES sc_context (context_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_core_context
        //
        CREATE TABLE IF NOT EXISTS sc_core_context (
            core_hash     DECIMAL(39) NOT NULL,
            context_hash  DECIMAL(39) NOT NULL,

            PRIMARY KEY (core_hash, context_hash),
            INDEX (core_hash) USING HASH,
            FOREIGN KEY (core_hash) REFERENCES sc_component_core (core_hash),
            INDEX (context_hash) USING HASH,
            FOREIGN KEY (context_hash) REFERENCES sc_context (context_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_user_component
        //
        CREATE TABLE IF NOT EXISTS sc_user_component (
            user_uuid    DECIMAL(39) NOT NULL,
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,

            PRIMARY KEY (user_uuid, comp_uuid, uploaded_at),
            INDEX (user_uuid) USING HASH,
            FOREIGN KEY (user_uuid) REFERENCES sc_user (user_uuid),
            INDEX (comp_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_component_group
        //
        CREATE TABLE IF NOT EXISTS sc_component_group (
            comp_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            group_uuid   DECIMAL(39) NOT NULL,

            PRIMARY KEY (comp_uuid, uploaded_at, group_uuid),
            INDEX (comp_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (comp_uuid, uploaded_at) REFERENCES sc_component (comp_uuid, uploaded_at),
            INDEX (group_uuid) USING HASH,
            FOREIGN KEY (group_uuid) REFERENCES sc_group (group_uuid)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow
        //
        CREATE TABLE IF NOT EXISTS sc_flow (
            flow_uuid      DECIMAL(39) NOT NULL,
            uploaded_at    DATETIME NOT NULL,
            core_hash      DECIMAL(39) NOT NULL,
            name           VARCHAR(45) NULL,
            creator        VARCHAR(45) NULL,
            creation_date  DATETIME NULL,
            rights_hash    DECIMAL(39) NULL,
            uri            VARCHAR(255) NULL,
            deleted        BOOLEAN NOT NULL DEFAULT FALSE,

            PRIMARY KEY (flow_uuid, uploaded_at),
            INDEX (rights_hash) USING HASH,
            FOREIGN KEY (rights_hash) REFERENCES sc_rights (rights_hash),
            INDEX (flow_uuid) USING HASH,
            INDEX (core_hash) USING HASH,
            INDEX (uri) USING HASH,
            INDEX (deleted) USING HASH
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_description
        //
        CREATE TABLE IF NOT EXISTS sc_flow_description (
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            description  TEXT NULL,

            PRIMARY KEY (flow_uuid, uploaded_at),
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_descriptor
        //
        CREATE TABLE IF NOT EXISTS sc_flow_descriptor (
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            descriptor   LONGTEXT NOT NULL,

            PRIMARY KEY (flow_uuid, uploaded_at),
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_tag
        //
        CREATE TABLE IF NOT EXISTS sc_flow_tag (
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            tag          VARCHAR(45) NOT NULL,

            PRIMARY KEY (flow_uuid, uploaded_at, tag),
            INDEX (flow_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at),
            INDEX (tag ASC)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_category
        //
        CREATE TABLE IF NOT EXISTS sc_flow_category (
            cat_name     VARCHAR(45) NOT NULL,
            description  TEXT NOT NULL,

            PRIMARY KEY (cat_name)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_cat_map
        //
        CREATE TABLE IF NOT EXISTS sc_flow_cat_map (
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            cat_name     VARCHAR(45) NOT NULL,

            PRIMARY KEY (flow_uuid, uploaded_at, cat_name),
            INDEX (flow_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at),
            INDEX (cat_name) USING HASH,
            FOREIGN KEY (cat_name) REFERENCES sc_flow_category (cat_name)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_comp_core
        //
        CREATE TABLE IF NOT EXISTS sc_flow_comp_core (
            flow_core_hash  DECIMAL(39) NOT NULL,
            comp_core_hash  DECIMAL(39) NOT NULL,

            PRIMARY KEY (flow_core_hash, comp_core_hash),
            INDEX (flow_core_hash) USING HASH,
            FOREIGN KEY (flow_core_hash) REFERENCES sc_flow (core_hash),
            INDEX (comp_core_hash) USING HASH,
            FOREIGN KEY (comp_core_hash) REFERENCES sc_component_core (core_hash)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_user_flow
        //
        CREATE TABLE IF NOT EXISTS sc_user_flow (
            user_uuid    DECIMAL(39) NOT NULL,
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,

            PRIMARY KEY (user_uuid, flow_uuid, uploaded_at),
            INDEX (user_uuid) USING HASH,
            FOREIGN KEY (user_uuid) REFERENCES sc_user (user_uuid),
            INDEX (flow_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_flow_group
        //
        CREATE TABLE IF NOT EXISTS sc_flow_group (
            flow_uuid    DECIMAL(39) NOT NULL,
            uploaded_at  DATETIME NOT NULL,
            group_uuid   DECIMAL(39) NOT NULL,

            PRIMARY KEY (flow_uuid, uploaded_at, group_uuid),
            INDEX (flow_uuid, uploaded_at) USING HASH,
            FOREIGN KEY (flow_uuid, uploaded_at) REFERENCES sc_flow (flow_uuid, uploaded_at),
            INDEX (group_uuid) USING HASH,
            FOREIGN KEY (group_uuid) REFERENCES sc_group (group_uuid)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_event_code
        //
        CREATE TABLE IF NOT EXISTS sc_event_code (
            evt_code     SMALLINT UNSIGNED NOT NULL,
            description  VARCHAR(45) NOT NULL,

            PRIMARY KEY (evt_code)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // sc_event
        //
        CREATE TABLE IF NOT EXISTS sc_event (
            timestamp   DATETIME NOT NULL,
            evt_code    SMALLINT UNSIGNED NOT NULL,
            user_uuid   DECIMAL(39) NULL,
            group_uuid  DECIMAL(39) NULL,
            comp_uuid   DECIMAL(39) NULL,
            flow_uuid   DECIMAL(39) NULL,
            metadata    TEXT NULL,

            PRIMARY KEY (timestamp),
            INDEX (evt_code) USING HASH,
            FOREIGN KEY (evt_code) REFERENCES sc_event_code (evt_code),
            INDEX (user_uuid) USING HASH,
            FOREIGN KEY (user_uuid) REFERENCES sc_user (user_uuid),
            INDEX (group_uuid) USING HASH,
            FOREIGN KEY (group_uuid) REFERENCES sc_group (group_uuid),
            INDEX (comp_uuid) USING HASH,
            FOREIGN KEY (comp_uuid) REFERENCES sc_component (comp_uuid),
            INDEX (flow_uuid) USING HASH,
            FOREIGN KEY (flow_uuid) REFERENCES sc_flow (flow_uuid)
        ) ENGINE = InnoDB DEFAULT CHARACTER SET = utf8;

        //
        // Insert default event codes
        //
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (100, "USER_CREATED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (101, "USER_DELETED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (102, "USER_RENAMED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (103, "USER_PROFILE_UPDATED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (104, "USER_JOINED_GROUP");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (105, "USER_PARTED_GROUP");

        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (200, "GROUP_CREATED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (201, "GROUP_DELETED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (202, "GROUP_RENAMED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (203, "GROUP_JOINED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (204, "GROUP_PARTED");

        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (300, "COMPONENT_UPLOADED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (301, "COMPONENT_DELETED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (303, "COMPONENT_UPDATED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (304, "COMPONENT_SHARED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (305, "COMPONENT_UNSHARED");

        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (400, "FLOW_UPLOADED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (401, "FLOW_DELETED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (403, "FLOW_UPDATED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (404, "FLOW_SHARED");
        INSERT IGNORE INTO sc_event_code (evt_code, description) VALUES (405, "FLOW_UNSHARED");
    </entry>

    <!-- USER -->
    <entry key="org.seasr.central.storage.db.query.user.add">
        INSERT INTO sc_user (user_uuid, screen_name, password, created_at, profile) VALUES (?, ?, ?, NOW(), ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.remove">
        UPDATE sc_user SET deleted = 1 WHERE user_uuid = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.update.password">
        UPDATE sc_user SET password = ? WHERE user_uuid = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.update.profile">
        UPDATE sc_user SET profile = ? WHERE user_uuid = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.get.uuid">
        SELECT user_uuid FROM sc_user WHERE screen_name = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.get.screen_name">
        SELECT screen_name FROM sc_user WHERE user_uuid = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.get.profile">
        SELECT profile FROM sc_user WHERE user_uuid = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.get.createdat">
        SELECT created_at FROM sc_user WHERE user_uuid = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.password.valid">
        SELECT 1 FROM sc_user WHERE user_uuid = ? AND password = ? AND deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.get.deleted">
        SELECT deleted FROM sc_user WHERE user_uuid = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.count">
        SELECT COUNT(1) FROM sc_user WHERE deleted = 0;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.list">
        SELECT user_uuid, screen_name, profile FROM sc_user WHERE deleted = 0 LIMIT ?, ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.user.component.add">
        INSERT INTO sc_user_component (user_uuid, comp_uuid, uploaded_at) VALUES (?, ?, ?);
    </entry>

    <!-- EVENTS -->
    <entry key="org.seasr.central.storage.db.query.event.add">
        INSERT INTO sc_event (timestamp, evt_code, user_uuid, group_uuid, comp_uuid, flow_uuid, metadata) VALUES (NOW(), ?, ? ,?, ?, ?, ?);
    </entry>

    <!-- RIGHTS -->
    <entry key="org.seasr.central.storage.db.query.rights.add">
        INSERT INTO sc_rights (rights_hash, text) VALUES (?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.rights.get.text">
        SELECT text FROM sc_rights WHERE rights_hash = ?;
    </entry>

    <!-- COMPONENTS -->
    <entry key="org.seasr.central.storage.db.query.datetime.now">
        SELECT NOW();
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.add">
        INSERT INTO sc_component (comp_uuid, uploaded_at, core_hash, name, creator, creation_date, rights_hash, uri) VALUES (?, ?, ?, ?, ?, ?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.add.description">
        INSERT INTO sc_comp_description (comp_uuid, uploaded_at, description) VALUES (?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.add.tag">
        INSERT INTO sc_comp_tag (comp_uuid, uploaded_at, tag) VALUES (?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.core.context.add">
        INSERT INTO sc_core_context (core_hash, context_hash) VALUES (?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.context.add">
        INSERT INTO sc_component_context (comp_uuid, uploaded_at, context_hash, mime_type) VALUES (?, ?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.add.descriptor">
        INSERT INTO sc_comp_descriptor (comp_uuid, uploaded_at, descriptor) VALUES (?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.get.id">
        SELECT comp_uuid FROM sc_component WHERE uri = ? LIMIT 1;
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.get.last_insert">
        SELECT core_hash, name, creator, rights_hash, uri, description, tag FROM (SELECT comp_uuid, uploaded_at, core_hash, name, creator, rights_hash, uri FROM sc_component WHERE comp_uuid = ? ORDER BY uploaded_at DESC LIMIT 1) c INNER JOIN sc_comp_description d INNER JOIN sc_comp_tag t ON (c.comp_uuid = d.comp_uuid AND c.uploaded_at = d.uploaded_at) AND (c.comp_uuid = t.comp_uuid AND c.uploaded_at = t.uploaded_at);
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.get.ver_count">
        SELECT COUNT(1) FROM sc_component WHERE comp_uuid = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.core.exists">
        SELECT 1 FROM sc_component_core WHERE core_hash = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.component.core.add">
        INSERT INTO sc_component_core (core_hash, firing_policy, mode, format, runnable, res_location) VALUES (?, ?, ?, ?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.context.exists">
        SELECT 1 FROM sc_context WHERE context_hash = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.context.add">
        INSERT INTO sc_context (context_hash, data) VALUES (?, ?);
    </entry>

    <!-- FLOWS -->
    <entry key="org.seasr.central.storage.db.query.flow.add">
        INSERT INTO sc_flow (uuid, version, upload_date) VALUES (?, ?, NOW());
    </entry>
    <entry key="org.seasr.central.storage.db.query.flow.add.id">
        INSERT IGNORE INTO sc_flow_id_map (orig_uri, user_uuid, flow_uuid) VALUES (?, ?, ?);
    </entry>
    <entry key="org.seasr.central.storage.db.query.flow.get.id.origuri.user">
        SELECT flow_uuid FROM sc_flow_id_map WHERE orig_uri = ? AND user_uuid = ?;
    </entry>
    <entry key="org.seasr.central.storage.db.query.flow.get.last.version.number">
        SELECT MAX(version) FROM sc_flow WHERE uuid = ? FOR UPDATE;
    </entry>
    <entry key="org.seasr.central.storage.db.query.flow.get.state.uuid.version">
        SELECT deleted FROM sc_flow WHERE uuid = ? AND version = ?;
    </entry>
</properties>
