<?xml version="1.0" encoding="ISO-8859-1"?>
<Configure id="Server" class="org.mortbay.jetty.Server">

  <!-- The main connector definition -->

  <Call name="addConnector">
    <Arg>
      <New class="org.mortbay.jetty.nio.SelectChannelConnector">
        <Set name="port"><SystemProperty name="jetty.port" default="8888"/></Set>
      </New>
    </Arg>
  </Call>

  <!-- The back end storage link -->

  <New id="bsl" class="org.seasr.central.storage.db.SQLiteLink">
  	<Call name="init">
  		<Arg>
  			<New class="java.util.Properties">
  				<Call name="loadFromXML">
  					<Arg>
  						<New class="java.io.FileInputStream"><Arg>conf/scs-store-sqlite.xml</Arg></New>
  					</Arg>
  				</Call>
  			</New>
  		</Arg>
  	</Call>
  </New>

  <!-- The REST servlet definitions -->

  <!-- User -->
  <New id="userAdd" class="org.seasr.central.ws.restlets.user.AddUserRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="userDelete" class="org.seasr.central.ws.restlets.user.DeleteUserRestlet">
  	<Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="userList" class="org.seasr.central.ws.restlets.user.ListUsersRestlet">
  	<Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="userInfo" class="org.seasr.central.ws.restlets.user.UserInfoRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="userComponentUpload" class="org.seasr.central.ws.restlets.user.UploadComponentRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="userFlowUpload" class="org.seasr.central.ws.restlets.user.UploadFlowRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>

  <!-- Repository -->
  <New id="repositoryRetrieveComponent" class="org.seasr.central.ws.restlets.repository.RetrieveComponentRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="repositoryRetrieveComponentContext" class="org.seasr.central.ws.restlets.repository.RetrieveComponentContextRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>
  <New id="repositoryRetrieveFlow" class="org.seasr.central.ws.restlets.repository.RetrieveFlowRestlet">
    <Set name="backendStoreLink"><Ref id="bsl"/></Set>
  </New>

  <!-- User REST servlet dispatcher -->
  <New id="userRED" class="org.seasr.central.ws.restlets.RestfulExtensibleDispatcher">
  		<Call name="add"><Arg><Ref id="userAdd"/></Arg></Call>
  		<Call name="add"><Arg><Ref id="userDelete"/></Arg></Call>
  		<Call name="add"><Arg><Ref id="userList"/></Arg></Call>
  		<Call name="add"><Arg><Ref id="userInfo"/></Arg></Call>
  		<Call name="add"><Arg><Ref id="userComponentUpload"/></Arg></Call>
  		<Call name="add"><Arg><Ref id="userFlowUpload"/></Arg></Call>
  </New>

  <!-- Repository REST servlet dispatcher -->
  <New id="repositoryRED" class="org.seasr.central.ws.restlets.RestfulExtensibleDispatcher">
        <Call name="add"><Arg><Ref id="repositoryRetrieveComponent"/></Arg></Call>
        <Call name="add"><Arg><Ref id="repositoryRetrieveComponentContext"/></Arg></Call>
        <Call name="add"><Arg><Ref id="repositoryRetrieveFlow"/></Arg></Call>
  </New>

  <!-- The basic contexts available -->

  <Set name="handlers">
  	<Array type="org.mortbay.jetty.Handler">
  	  <Item>
  	  	<New id="RequestLogHandler" class="org.mortbay.jetty.handler.RequestLogHandler"/>
  	  </Item>
  	  <Item>
  	  	<New id="userContext" class="org.mortbay.jetty.servlet.Context">
  			<Set name="contextPath">/services/users</Set>
  			<Call name="addServlet">
  				<Arg>
  					<New class="org.mortbay.jetty.servlet.ServletHolder"><Arg><Ref id="userRED"/></Arg></New>
  				</Arg>
  				<Arg>/</Arg>
  			</Call>
  		</New>
  	  </Item>
      <Item>
        <New id="repositoryContext" class="org.mortbay.jetty.servlet.Context">
            <Set name="contextPath">/repository</Set>
            <Call name="addServlet">
                <Arg>
                    <New class="org.mortbay.jetty.servlet.ServletHolder"><Arg><Ref id="repositoryRED"/></Arg></New>
                </Arg>
                <Arg>/</Arg>
            </Call>
        </New>
      </Item>
  	  <Item>
  		<New id="resourceContextLogs" class="org.mortbay.jetty.servlet.Context">
  			<Set name="contextPath">/logs</Set>
  			<Set name="resourceBase"><SystemProperty name="jetty.docroot" default="logs"/></Set>
  			<Call name="addServlet"><Arg>org.mortbay.jetty.servlet.DefaultServlet</Arg><Arg>/</Arg></Call>
  		</New>
  	  </Item>
  	  <Item>
  		<New id="resourceContext" class="org.mortbay.jetty.servlet.Context">
  			<Set name="contextPath">/</Set>
  			<Set name="resourceBase"><SystemProperty name="jetty.docroot" default="static"/></Set>
  			<Call name="addServlet"><Arg>org.mortbay.jetty.servlet.DefaultServlet</Arg><Arg>/</Arg></Call>
  		</New>
  	  </Item>
  	 </Array>
  </Set>

  <!-- Set up the logging facility for the server -->
  <Ref id="RequestLogHandler">
  	<Set name="server"><Ref id="Server" /></Set>
  	<Set name="requestLog">
  		<New class="org.mortbay.jetty.NCSARequestLog">
  			<Set name="filename">logs/access.log</Set>
  			<Set name="append">true</Set>
  			<Set name="extended">false</Set>
  		</New>
  	</Set>
  </Ref>

</Configure>
